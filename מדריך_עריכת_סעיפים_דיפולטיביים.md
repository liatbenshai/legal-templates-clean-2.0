# 📚 מדריך מפורט לעריכת סעיפים דיפולטיביים בצוואות

## 🎯 **סקירה כללית**

מדריך זה מסביר כיצד לערוך, להוסיף ולשנות את הסעיפים הדיפולטיביים במערכת הצוואות החדשה שכוללת תמיכה מלאה במגדר (זכר/נקבה/רבים).

---

## 📁 **מיקום הקבצים הרלוונטיים**

### **קבצים עיקריים:**
- **`lib/professional-will-texts.ts`** - הקובץ הראשי עם כל הסעיפים
- **`lib/hebrew-gender.ts`** - מערכת המגדר והנטיות
- **`components/ProfessionalWillForm.tsx`** - הממשק הראשי

### **סעיפים דיפולטיביים חדשים:**
```typescript
export const defaultWillSections: ProfessionalWillSection[]
```

---

## ✨ **הוספת סעיפים דיפולטיביים חדשים**

### **מבנה בסיסי של סעיף:**

```typescript
{
  id: 'unique-section-id',
  title: 'כותרת הסעיף (דיפולטיבי)',
  category: 'both' | 'individual' | 'mutual',
  content: `תוכן הסעיף עם תמיכה במגדר...`,
  variables: ['var1', 'var2', 'var3'],
  required: true | false,
  order: מספר_סדר
}
```

### **דוגמה מלאה - הוספת סעיף חדש:**

```typescript
{
  id: 'default-charity-donation',
  title: 'תרומה לצדקה (דיפולטיבי)',
  category: 'both',
  content: `אני {{gender:מצווה|מצווה|מצווים}} כי סכום של {{donation_amount}} ש"ח יועבר כתרומה ל{{charity_name}}.

התרומה תבוא לביטוי {{gender:ברצוני|ברצוני|ברצוננו}} לתרום למטרות צדקה ולעזור לזולת.

{{gender:יורשיי|יורשיי|יורשינו}} יהיו {{gender:אחראים|אחראיות|אחראים}} לביצוע התרומה תוך 30 ימים מקבלת צו קיום הצוואה.`,
  variables: ['donation_amount', 'charity_name'],
  required: false,
  order: 25
}
```

---

## 🎨 **סינטקס המגדר החדש והמתקדם**

### **1. דפוס מתקדם עם 3 אפשרויות:**
```typescript
{{gender:זכר|נקבה|רבים}}
```

**דוגמאות:**
- `{{gender:מצהיר|מצהירה|מצהירים}}`
- `{{gender:תושב|תושבת|תושבי}}`
- `{{gender:אחראי|אחראית|אחראים}}`

### **2. דפוס פשוט עם 2 אפשרויות:**
```typescript
{{gender:זכר|נקבה}}
```

**דוגמה:**
- `{{gender:נשוי|נשואה}}` → רבים יקבלו "נשוי"

### **3. דפוס יחיד (רק לזכר):**
```typescript
{{gender:זכר}}
```

**דוגמה:**
- `{{gender:תושב}}` → זכר: "תושב", נקבה: "", רבים: "תושב"

---

## 🔧 **עריכת סעיפים קיימים**

### **שלב 1: מציאת הסעיף**
```typescript
// ב- lib/professional-will-texts.ts
// חפש את הסעיף לפי ה-ID שלו
const targetSection = defaultWillSections.find(s => s.id === 'default-identity-declaration');
```

### **שלב 2: עריכת התוכן**
```typescript
// דוגמה: שינוי סעיף הצהרת זהות
{
  id: 'default-identity-declaration',
  title: 'הצהרת זהות משופרת (דיפולטיבי)',
  category: 'both',
  content: `אני {{testator_full_name}}, ת.ז. {{testator_id}}, 
  {{gender:תושב|תושבת|תושבי}} {{testator_city}}, 
  רחוב {{testator_address}}, 
  גיל {{testator_age}} שנים,
  
  // הוספה חדשה:
  {{gender:נשוי|נשואה|נשואים}} ל{{spouse_full_name}} משנת {{marriage_year}},
  ו{{gender:אב|אם|הורים}} ל{{children_count}} ילדים יקרים,
  
  {{gender:מצהיר|מצהירה|מצהירים}} בזאת בפני העדים החתומים מטה:`,
  variables: [
    'testator_full_name', 'testator_id', 'testator_city', 
    'testator_address', 'testator_age', 'spouse_full_name', 
    'marriage_year', 'children_count'
  ],
  required: true,
  order: 1
}
```

### **שלב 3: הוספת משתנים חדשים**
כאשר מוסיפים משתנה חדש, יש לוודא:

1. **הוספה לרשימת Variables:**
```typescript
variables: ['existing_var', 'new_variable_name']
```

2. **שימוש בתוכן:**
```typescript
content: `... {{new_variable_name}} ...`
```

3. **הגדרה בממשק (ProfessionalWillForm.tsx):**
```typescript
const [newVariableName, setNewVariableName] = useState('');
```

---

## 📝 **דוגמאות מתקדמות**

### **דוגמה 1: סעיף עם הבחנה בין יחיד לרבים**

```typescript
{
  id: 'default-children-relationships',
  title: 'יחסים עם הילדים (דיפולטיבי)',
  category: 'both',
  content: `{{gender:ילדיי|ילדיי|ילדינו}} {{children_list}} {{gender:הם|הן|הם}} אור {{gender:עיניי|עיניי|עינינו}}.

{{gender:גידלתי|גידלתי|גידלנו}} {{gender:אותם|אותן|אותם}} באהבה ובמסירות, ו{{gender:זכיתי|זכיתי|זכינו}} לראות {{gender:אותם|אותן|אותם}} גדלים ומתפתחים.

{{gender:בקשתי|בקשתי|בקשתנו}} מכל {{gender:ילדיי|ילדיי|ילדינו}} לכבד זה את זה ולהמשיך לאהוב כפי ש{{gender:גידלתי|גידלתי|גידלנו}} {{gender:אותם|אותן|אותם}}.`,
  variables: ['children_list'],
  required: false,
  order: 30
}
```

### **דוגמה 2: סעיף עם טיפול בבן/בת זוג**

```typescript
{
  id: 'default-spouse-appreciation',
  title: 'הערכה לבן/בת הזוג (דיפולטיבי)',
  category: 'individual',
  content: `אני רוצה לומר תודה ל{{spouse_full_name}}, {{gender:בן זוגי|בת זוגי|בני זוגנו}} {{gender:האהוב|האהובה|האהובים}}.

{{spouse_full_name}} {{gender:היה|הייתה|היו}} {{gender:שותפי|שותפתי|שותפינו}} בחיים ו{{gender:עזר|עזרה|עזרו}} לי בכל צעד.

{{gender:בזכותו|בזכותה|בזכותם}} הצלחתי להקים בית ולגדל משפחה יפה.`,
  variables: ['spouse_full_name'],
  required: false,
  order: 31
}
```

### **דוגמה 3: סעיף מתקדם עם תנאים**

```typescript
{
  id: 'default-conditional-inheritance',
  title: 'ירושה מותנית (דיפולטיבי)',
  category: 'both',
  content: `במקרה ש{{condition_heir}} {{gender:יסיים|תסיים|יסיימו}} {{required_education}}, 
{{gender:הוא יקבל|היא תקבל|הם יקבלו}} חלק נוסף של {{bonus_percentage}}% מהעיזבון.

התנאי צריך להתמלא תוך {{time_limit}} שנים מיום {{gender:פטירתי|פטירתי|פטירתנו}}.

אם התנאי לא יתמלא, החלק הנוסף יתחלק בין יתר {{gender:יורשיי|יורשיי|יורשינו}} בחלקים שווים.`,
  variables: ['condition_heir', 'required_education', 'bonus_percentage', 'time_limit'],
  required: false,
  order: 32
}
```

---

## 🧪 **בדיקת הסעיפים החדשים**

### **1. בדיקה ידנית:**
```typescript
import { 
  processDefaultWillSection, 
  detectGenderFromName 
} from '@/lib/hebrew-gender';

// בדיקת סעיף עם מגדרים שונים
const testSection = defaultWillSections.find(s => s.id === 'your-section-id');
const testVariables = {
  testator_full_name: 'דוד כהן',
  testator_id: '123456789',
  // ...
};

// בדיקה לזכר
const maleResult = processDefaultWillSection(
  testSection.content, 
  testVariables, 
  'male'
);

// בדיקה לנקבה
const femaleResult = processDefaultWillSection(
  testSection.content, 
  testVariables, 
  'female'
);

// בדיקה לרבים
const pluralResult = processDefaultWillSection(
  testSection.content, 
  testVariables, 
  'plural'
);

console.log('זכר:', maleResult);
console.log('נקבה:', femaleResult);
console.log('רבים:', pluralResult);
```

### **2. בדיקת זיהוי מגדר אוטומטי:**
```typescript
import { detectGenderFromName } from '@/lib/hebrew-gender';

// בדיקת שמות שונים
console.log(detectGenderFromName('דוד כהן')); // 'male'
console.log(detectGenderFromName('שרה לוי')); // 'female'
console.log(detectGenderFromName('דוד ושרה כהן')); // null (מרובה)
```

---

## ⚠️ **טיפים חשובים ושגיאות נפוצות**

### **✅ עשה:**
1. **השתמש תמיד בדפוס הזה:** `{{gender:זכר|נקבה|רבים}}`
2. **וודא שהמשתנים מוגדרים** ברשימת `variables`
3. **בדוק את הסעיף עם כל המגדרים** לפני שמירה
4. **השתמש בסדר לוגי** עבור `order`
5. **הוסף תיאור ברור** ל-`title`

### **❌ אל תעשה:**
1. **אל תשכח** את הרשימה `variables: [...]`
2. **אל תשתמש בדפוסים ישנים** כמו `/ת` או `/ה`
3. **אל תעשה** משתנים ללא ערכי ברירת מחדל
4. **אל תשכח** לבדוק עם מגדרים שונים
5. **אל תעשה** `id` כפולים

### **🐛 שגיאות נפוצות:**

#### **שגיאה: משתנה לא מוגדר**
```typescript
// ❌ לא טוב
content: `אני מצווה ל{{heir_name}}` // אבל אין 'heir_name' ב-variables

// ✅ טוב
content: `אני מצווה ל{{heir_name}}`
variables: ['heir_name']
```

#### **שגיאה: דפוס מגדר שגוי**
```typescript
// ❌ לא טוב
content: `אני מצהיר/ת`

// ✅ טוב
content: `אני {{gender:מצהיר|מצהירה|מצהירים}}`
```

#### **שגיאה: סדר לא נכון**
```typescript
// ❌ לא טוב - יש כבר order: 1
order: 1

// ✅ טוב - מספר סדר ייחודי
order: 35
```

---

## 🚀 **הוספת פונקציונליות מתקדמת**

### **1. תמיכה בתנאים:**
```typescript
// במקום להשתמש ב-if בתוכן, השתמש בדפוס זה:
content: `{{#if condition_variable}}
התוכן שיוצג רק אם התנאי מתקיים
{{/if}}

{{#unless other_condition}}
התוכן שיוצג רק אם התנאי לא מתקיים  
{{/unless}}`
```

### **2. חזרות על רשימות:**
```typescript
// עבור רשימת יורשים
content: `היורשים שלי הם:
{{#each heirs_list}}
• {{this.name}} - {{this.share}}%
{{/each}}`
```

### **3. פורמט תאריכים:**
```typescript
// הוספת תאריך אוטומטי
content: `צוואה זו נכתבה ביום {{current_date}} 
בעיר {{testator_city}}`
```

---

## 📚 **דוגמאות שלמות - 5 סעיפים חדשים**

### **סעיף 1: מסר אישי לבן זוג**
```typescript
{
  id: 'default-spouse-message',
  title: 'מסר אישי לבן/בת זוג (דיפולטיבי)',
  category: 'both',
  content: `{{spouse_full_name}} {{gender:שלי|שלי|שלנו}} {{gender:האהוב|האהובה|האהובים}},

{{gender:אתה היית|את היית|אתם הייתם}} {{gender:שותפי|שותפתי|שותפינו}} בחיים, {{gender:אהבתי|אהבתי|אהבתנו}} הגדולה ו{{gender:חברי|חברתי|חברינו}} {{gender:הטוב|הטובה|הטובים}} ביותר.

{{marriage_years}} שנות נישואין עברו עלינו כרגע אחד. {{gender:זכרתי|זכרתי|זכרנו}} לכל רגע יפה שחלקנו יחדיו.

{{gender:אני מבקש|אני מבקשת|אנו מבקשים}} מכל {{gender:ילדינו|ילדינו|ילדינו}} לכבד {{gender:אותך|אותך|אתכם}} ולדאוג {{gender:לך|לך|לכם}} כפי ש{{gender:דאגת|דאגת|דאגתם}} לנו כל השנים.`,
  variables: ['spouse_full_name', 'marriage_years'],
  required: false,
  order: 50
}
```

### **סעיף 2: הנחיות לקבורה מפורטות**
```typescript
{
  id: 'default-burial-detailed',
  title: 'הנחיות קבורה מפורטות (דיפולטיבי)',
  category: 'both',
  content: `בנוגע לסידורי הקבורה {{gender:שלי|שלי|שלנו}}, {{gender:אני מבקש|אני מבקשת|אנו מבקשים}}:

1. **מיקום הקבורה:** ב{{cemetery_name}}, חלקה {{plot_section}}
2. **סוג הטקס:** {{ceremony_type}} עם השתתפות {{family_only}}
3. **תרומת איברים:** {{organ_donation_choice}}
4. **הקמת מצבה:** {{gravestone_type}} עם הכיתוב "{{gravestone_inscription}}"

{{gender:אני מבקש|אני מבקשת|אנו מבקשים}} מ{{gender:יורשיי|יורשיי|יורשינו}} לכבד {{gender:רצוני|רצוני|רצוננו}} זה ולא לבצע שינויים בהוראות אלה.

הלוויה תהיה פשוטה וצנועה, ללא הוצאות מיותרות.`,
  variables: [
    'cemetery_name', 'plot_section', 'ceremony_type', 
    'family_only', 'organ_donation_choice', 
    'gravestone_type', 'gravestone_inscription'
  ],
  required: false,
  order: 51
}
```

### **סעיף 3: טיפול בחיות מחמד מתקדם**
```typescript
{
  id: 'default-pets-advanced',
  title: 'טיפול בחיות מחמד מתקדם (דיפולטיבי)',
  category: 'both',
  content: `חיות המחמד {{gender:שלי|שלי|שלנו}}: {{pets_list}} {{gender:היו|היו|היו}} חלק מהמשפחה וראויות לטיפול מיוחד.

**מינוי מטפל:**
{{gender:אני ממנה|אני ממנה|אנו ממנים}} את {{pet_caregiver_name}} (ת.ז. {{pet_caregiver_id}}) כ{{gender:מטפל|מטפלת|מטפלים}} בחיות.

**תקציב טיפול:**
- סכום כולל: {{pet_care_budget}} ש"ח
- תשלום חודשי: {{monthly_pet_allowance}} ש"ח
- עבור טיפול וטרינרי חירום: {{emergency_vet_budget}} ש"ח

**התחייבויות המטפל:**
1. לספק מזון איכותי ומים נקיים מדי יום
2. לוודא טיפול וטרינרי שוטף כל {{vet_checkup_frequency}} חודשים
3. לספק אהבה, משחק ופעילות גופנית
4. להודיע ל{{gender:יורשיי|יורשיי|יורשינו}} על כל בעיה רפואית

אם {{pet_caregiver_name}} לא {{gender:יוכל|תוכל|יוכלו}} להמשיך, החיות יועברו ל{{backup_pet_caregiver}}.`,
  variables: [
    'pets_list', 'pet_caregiver_name', 'pet_caregiver_id',
    'pet_care_budget', 'monthly_pet_allowance', 'emergency_vet_budget',
    'vet_checkup_frequency', 'backup_pet_caregiver'
  ],
  required: false,
  order: 52
}
```

### **סעיף 4: נכסים דיגיטליים מקיפים**
```typescript
{
  id: 'default-digital-comprehensive',
  title: 'נכסים דיגיטליים מקיפים (דיפולטיבי)',
  category: 'both',
  content: `הנכסים הדיגיטליים {{gender:שלי|שלי|שלנו}} מהווים חלק חשוב מהמורשת:

**📱 רשתות חברתיות:**
• פייסבוק: {{facebook_account}}
• אינסטגרם: {{instagram_account}}  
• לינקדאין: {{linkedin_account}}
• טוויטר: {{twitter_account}}

**☁️ אחסון ענן:**
• Google Drive: {{google_drive_account}}
• Dropbox: {{dropbox_account}}
• iCloud: {{icloud_account}}
• OneDrive: {{onedrive_account}}

**💰 נכסים פיננסיים דיגיטליים:**
• ביטקוין: {{bitcoin_wallet}}
• אתריום: {{ethereum_wallet}}
• ארנקים נוספים: {{other_crypto_wallets}}

**🌐 נכסי אינטרנט:**
• אתרים: {{websites_list}}
• דומיינים: {{domains_list}}
• ערוצי יוטיוב: {{youtube_channels}}

**🔐 גישה ואבטחה:**
כל המידע לגישה נמצא ב{{password_manager}} או במעטפה חתומה אצל {{password_keeper}}.

{{digital_heir_name}} {{gender:ימונה|תמונה|ימונו}} כ{{gender:יורש|יורשת|יורשים}} דיגיטלי ו{{gender:יהיה אחראי|תהיה אחראית|יהיו אחראים}} לניהול כל הנכסים הדיגיטליים.`,
  variables: [
    'facebook_account', 'instagram_account', 'linkedin_account', 'twitter_account',
    'google_drive_account', 'dropbox_account', 'icloud_account', 'onedrive_account',
    'bitcoin_wallet', 'ethereum_wallet', 'other_crypto_wallets',
    'websites_list', 'domains_list', 'youtube_channels',
    'password_manager', 'password_keeper', 'digital_heir_name'
  ],
  required: false,
  order: 53
}
```

### **סעיף 5: ירושה מותנית מתקדמת**
```typescript
{
  id: 'default-conditional-advanced',
  title: 'ירושה מותנית מתקדמת (דיפולטיבי)',
  category: 'both',
  content: `{{gender:אני קובע|אני קובעת|אנו קובעים}} התנאים הבאים לירושה:

**📚 תנאי השכלה:**
{{education_heir}} {{gender:יקבל|תקבל|יקבלו}} {{education_bonus}}% נוספים מהעיזבון אם {{gender:יסיים|תסיים|יסיימו}} {{required_degree}} עד גיל {{max_age_education}}.

**💼 תנאי קריירה:**
{{career_heir}} {{gender:יקבל|תקבל|יקבלו}} {{career_bonus}}% נוספים אם {{gender:יעבוד|תעבוד|יעבדו}} בתחום {{preferred_career}} למשך {{min_work_years}} שנים לפחות.

**👨‍👩‍👧‍👦 תנאי משפחה:**
{{family_heir}} {{gender:יקבל|תקבל|יקבלו}} {{family_bonus}}% נוספים אם {{gender:יקים|תקים|יקימו}} משפחה ו{{gender:יביא|תביא|יביאו}} לעולם {{min_grandchildren}} נכדים לפחות.

**🏠 תנאי מגורים:**
{{residence_heir}} {{gender:יקבל|תקבל|יקבלו}} {{residence_bonus}}% נוספים אם {{gender:יתגורר|תתגורר|יתגוררו}} בישראל למשך {{min_residence_years}} שנים רצופות.

**⏰ מסגרת זמן:**
כל התנאים צריכים להתמלא תוך {{time_limit_years}} שנים מיום {{gender:פטירתי|פטירתי|פטירתנו}}.

**🔄 אי מילוי תנאים:**
אם תנאי לא יתמלא, החלק הנוסף יחזור לעיזבון הכללי ויתחלק בין כל {{gender:יורשיי|יורשיי|יורשינו}} בחלקים שווים.

מישהו {{gender:שיקיים|שתקיים|שיקיימו}} יותר מתנאי אחד {{gender:יקבל|תקבל|יקבלו}} את סכום כל הבונוסים הרלוונטיים.`,
  variables: [
    'education_heir', 'education_bonus', 'required_degree', 'max_age_education',
    'career_heir', 'career_bonus', 'preferred_career', 'min_work_years',
    'family_heir', 'family_bonus', 'min_grandchildren',
    'residence_heir', 'residence_bonus', 'min_residence_years',
    'time_limit_years'
  ],
  required: false,
  order: 54
}
```

---

## 🎯 **סיכום ומימושים מעשיים**

### **✅ השלמת מדריך זה מאפשר:**
1. **הוספת סעיפים חדשים** עם תמיכה מלאה במגדר
2. **עריכת סעיפים קיימים** בקלות ובביטחון
3. **בדיקה ואימות** של השינויים
4. **תחזוקה שוטפת** של המערכת

### **🔄 זרימת עבודה מומלצת:**
1. **תכנן** את הסעיף החדש על נייר
2. **כתוב** את הסעיף עלsyntax הנכון
3. **בדוק** עם כל המגדרים (זכר/נקבה/רבים)
4. **הוסף** למערך `defaultWillSections`
5. **בדוק** שהכל עובד במערכת

### **📞 קבלת עזרה:**
- בעיות בסינטקס? בדוק את הדוגמאות למעלה
- שגיאות מגדר? בדוק את `lib/hebrew-gender.ts`
- בעיות ממשק? בדוק את `components/ProfessionalWillForm.tsx`

---

**🎉 כל הכבוד! אתה מוכן ליצור ולערוך סעיפי צוואה מתקדמים עם תמיכה מלאה במגדר!**
