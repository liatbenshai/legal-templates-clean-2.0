# 📋 TODO - פיתוח מערכת תבניות משפטיות גמישה

תאריך: 6 אוקטובר 2025

---

## 🎯 חזון המערכת

מערכת **גמישה מאוד** ליצירת מסמכים משפטיים עם:
- תמיכה מלאה בעברית (זכר/נקבה)
- טבלאות דינמיות (צדדים, יורשים, נכסים)
- שיפור AI אוטומטי של טקסט משפטי
- ייצוא ל-PDF/Word עם RTL מושלם
- מודולריות מקסימלית

---

## ✅ מה כבר קיים (הושלם)

- [x] מערכת בסיסית לבניית תבניות
- [x] שדות דינמיים (13 סוגים)
- [x] עורך מתקדם עם בלוקים
- [x] תגיות (tags) לארגון תבניות
- [x] מספור אוטומטי לסעיפים (4 סגנונות)
- [x] רכיב RepeatableFieldGroup לטבלאות דינמיות
- [x] מודול דוגמה לצו ירושה
- [x] הגדרות עמוד (שוליים, גודל, כיווניות)
- [x] ספריות ייצוא (jspdf, docx)

---

## 🔧 בעיות שצריך לתקן ASAP (עדיפות גבוהה)

### 1️⃣ תיקון שגיאות קומפילציה
**סטטוס**: 🔴 דחוף
**בעיה**: שגיאות TypeScript מונעות בנייה
**קבצים שצריך לתקן**:
- [ ] `lib/ai-legal-writer.ts` - שגיאת טיפוס Response
- [ ] `app/editor/page.tsx` - שגיאת document.createElement
- [ ] כל קובץ אחר שנותן שגיאת קומפילציה

**משך זמן מוערך**: 30 דקות

---

### 2️⃣ השלמת קבצים חסרים
**סטטוס**: 🔴 דחוף
**בעיה**: קבצים חסרים: TemplateCard, TemplateSearch, FieldsForm, DocumentPreview
**פתרון**:
- [ ] העתקת כל הקבצים מ-legal-templates
- [ ] וידוא שכל ה-imports עובדים
- [ ] בדיקה שהאפליקציה עולה

**משך זמן מוערך**: 15 דקות

---

### 3️⃣ תיקון גופן דיפולט ל-David 13
**סטטוס**: ✅ הושלם חלקית
**נותר לעשות**:
- [x] שינוי דיפולט ב-AdvancedTemplateBuilder
- [x] שינוי דיפולט ב-TemplateBuilder
- [ ] שינוי דיפולט בכל רכיבי ה-UI
- [ ] הוספת פונט David לכל תיבות טקסט
- [ ] CSS גלובלי לפונט David

**משך זמן מוערך**: 20 דקות

---

## 🚀 תכונות חדשות שצריך להוסיף (עדיפות לפי סדר)

### 4️⃣ מערכת חתימות
**סטטוס**: 🟡 חדש
**דרישות**:
- [ ] בלוק חתימה בעורך (כבר קיים חלקית)
- [ ] אפשרות להוסיף מספר חתימות
- [ ] שדות: שם החותם, תפקיד, תאריך
- [ ] קו חתימה מעוצב (____________)
- [ ] אפשרות להעלות תמונת חתימה

**רכיבים לפיתוח**:
```typescript
components/SignatureBlock.tsx       // בלוק חתימה אחת
components/SignatureList.tsx        // רשימת חתימות
components/SignatureUploader.tsx    // העלאת תמונת חתימה
```

**משך זמן מוערך**: 2 שעות

---

### 5️⃣ מערכת זכר/נקבה (Gender-aware Hebrew)
**סטטוס**: 🟡 חדש - **קריטי לעברית!**
**דרישות**:
- [ ] שדה בחירה: זכר/נקבה/רבים לכל ישות
- [ ] מערכת שפה שמחליפה פעלים/תארים
- [ ] תמיכה בנטיות שונות (עשה/עשתה, אמר/אמרה)
- [ ] בדיקת הקשר אוטומטית

**דוגמאות לשינוי**:
```
זכר:   "המנוח עשה"
נקבה:  "המנוחה עשתה"
רבים:  "המנוחים עשו"
```

**רכיבים לפיתוח**:
```typescript
components/GenderSelector.tsx       // בורר זכר/נקבה
lib/hebrew-gender.ts                // מנוע נטיות עברית
lib/gender-templates.ts             // תבניות משפטים לפי מגדר
```

**מילון דוגמה**:
```typescript
{
  'המנוח': { male: 'המנוח', female: 'המנוחה', plural: 'המנוחים' },
  'עשה': { male: 'עשה', female: 'עשתה', plural: 'עשו' },
  'אמר': { male: 'אמר', female: 'אמרה', plural: 'אמרו' },
  'חתם': { male: 'חתם', female: 'חתמה', plural: 'חתמו' },
}
```

**משך זמן מוערך**: 4 שעות

---

### 6️⃣ טבלאות דינמיות מתקדמות (לצדדים בכתבי בית דין)
**סטטוס**: 🟡 חדש - **גמישות מקסימלית!**

**דרישות**:
- [ ] **טבלת צדדים** שמשתנה לפי תפקיד
  - אם מייצג תובעים → טבלת תובעים + שדה אחד לנתבעים
  - אם מייצג נתבעים → טבלת נתבעים + שדה אחד לתובעים
- [ ] **הגדרת עמודות גמישה** - המשתמש בוחר אילו שדות יהיו בטבלה
- [ ] **תנאים דינמיים** - הצג/הסתר טבלאות לפי בחירות
- [ ] **חישובים אוטומטיים** בטבלה (סכומים, אחוזים)

**רכיבים לפיתוח**:
```typescript
components/DynamicTable.tsx                  // טבלה גמישה לחלוטין
components/PartyTable.tsx                    // טבלת צדדים (תובעים/נתבעים)
components/ConditionalBlock.tsx              // בלוק מותנה
components/TableColumnConfigurator.tsx       // הגדרת עמודות
lib/table-calculator.ts                      // מחשבון לטבלאות
```

**דוגמה לשימוש**:
```tsx
<PartyTable
  role="plaintiff"  // או "defendant"
  columns={['שם', 'תעודת_זהות', 'כתובת', 'טלפון']}
  minRows={1}
  maxRows={10}
  showOpponentSummary={true}  // הצג סיכום צד שני
/>
```

**משך זמן מוערך**: 6 שעות

---

### 7️⃣ שיפור תוכן AI - הסבר מפורט
**סטטוס**: 🟡 קיים חלקית - צריך הסבר ושיפור

**איך זה עובד כרגע**:
- קיים מודול `lib/ai-legal-writer.ts`
- שולח טקסט ל-Claude API
- מקבל חזרה טקסט משופר בעברית משפטית

**מה חסר**:
- [ ] כפתור ברור בממשק "שפר עברית משפטית"
- [ ] הדגמה חזותית של לפני/אחרי
- [ ] הסברים למשתמש מה השתנה
- [ ] אפשרות לבחור סגנון (פורמלי/פשוט/מפורט)
- [ ] היסטוריה של שיפורים

**רכיבים לפיתוח**:
```typescript
components/AIIm prover.tsx               // כפתור + ממשק לשיפור
components/BeforeAfterComparison.tsx    // השוואה ויזואלית
components/AIImprovementHistory.tsx     // היסטוריה
lib/ai-improvement-engine.ts            // מנוע משופר
```

**אינטגרציה**:
- בעורך תבניות: כפתור "שפר טקסט"
- בעורך מסמכים: שיפור בזמן אמת
- בתצוגה מקדימה: הצעות לשיפור

**משך זמן מוערך**: 3 שעות

---

### 8️⃣ כפתורי ייצוא ל-PDF/Word - חיבור לממשק
**סטטוס**: 🟡 קיים הקוד - צריך אינטגרציה

**מה כבר קיים**:
- ✅ `lib/document-export.ts` - מנוע ייצוא
- ✅ `components/ExportButtons.tsx` - כפתורים
- ✅ ספריות jspdf ו-docx מותקנות

**מה חסר**:
- [ ] חיבור כפתורים לעמוד TemplatePreview
- [ ] בדיקה שהייצוא עובד
- [ ] תמיכה בפונט David בייצוא
- [ ] תמיכה מלאה ב-RTL בייצוא
- [ ] טיפול בטבלאות מורכבות בייצוא

**משך זמן מוערך**: 1.5 שעות

---

## 🏗️ ארכיטקטורה מודולרית חדשה (המטרה)

### עקרונות תכנון:
1. **כל סוג מסמך = מודול נפרד**
2. **רכיבים קטנים וממוקדים**
3. **קל להוסיף מסמך חדש**
4. **לא משפיע על קוד קיים**

### מבנה מוצע:

```
components/
├── DocumentModules/           ⬅️ מודולים לפי סוג מסמך
│   ├── InheritanceOrder.tsx   ✅ קיים (צו ירושה)
│   ├── Will.tsx               🟡 לפיתוח (צוואה)
│   ├── CourtPetition.tsx      🟡 לפיתוח (כתב בית דין)
│   ├── PowerOfAttorney.tsx    🟡 לפיתוח (ייפוי כוח)
│   └── Contract.tsx           🟡 לפיתוח (הסכם)
│
├── SharedComponents/          ⬅️ רכיבים משותפים
│   ├── RepeatableFieldGroup.tsx  ✅ קיים
│   ├── DynamicTable.tsx          🟡 לפיתוח
│   ├── PartyTable.tsx            🟡 לפיתוח
│   ├── SignatureBlock.tsx        🟡 לפיתוח
│   ├── GenderSelector.tsx        🟡 לפיתוח
│   ├── ConditionalBlock.tsx      🟡 לפיתוח
│   └── AIImprover.tsx            🟡 לפיתוח
│
├── ExportButtons.tsx          ✅ קיים
├── TagsInput.tsx              ✅ קיים
└── AutoNumbering.tsx          ✅ קיים
```

---

## 📝 TODO מפורט לפי סדר עדיפות

### 🔴 URGENT - תיקונים קריטיים (ימים 1-2)

#### A. תיקון שגיאות קומפילציה
- [ ] תקן ai-legal-writer.ts (שגיאת Response type)
- [ ] תקן editor/page.tsx (שגיאת document)
- [ ] הרץ בדיקת lint על כל הקבצים
- [ ] וודא שהדוקר עולה בלי שגיאות

**זמן**: 1 שעה

#### B. השלמת קבצים חסרים והרצה ראשונית
- [ ] העתק את כל הקבצים מ-legal-templates
- [ ] בדוק שכל ה-imports תקינים
- [ ] בנה והעלה את הדוקר בהצלחה
- [ ] וודא שהאפליקציה נגישה ב-localhost:3000
- [ ] בדוק שאפשר ליצור תבנית בסיסית

**זמן**: 1 שעה

---

### 🟠 HIGH PRIORITY - תכונות חיוניות (ימים 3-5)

#### C. מערכת חתימות מלאה
- [ ] יצירת SignatureBlock.tsx
  - שדה "שם החותם"
  - שדה "תפקיד" (עד, צד, עורך דין וכו')
  - תאריך חתימה
  - קו חתימה מעוצב
- [ ] SignatureList.tsx - ניהול מספר חתימות
- [ ] אופציה להעלות תמונת חתימה (SignatureUploader.tsx)
- [ ] טמפלייט חתימה במסמך (RTL)
- [ ] שמירה ושחזור חתימות

**זמן**: 3 שעות

#### D. מערכת זכר/נקבה (Gender-aware)
**חיוני לעברית משפטית!**

##### שלב 1: תשתית בסיסית
- [ ] יצירת `lib/hebrew-gender.ts`
  - מילון פעלים (עשה/עשתה/עשו)
  - מילון תארים (טוב/טובה/טובים)
  - מילון תארים משפטיים (המנוח/המנוחה)
- [ ] פונקציית החלפה אוטומטית
- [ ] בדיקות unit tests למילון

**זמן**: 2 שעות

##### שלב 2: רכיב UI
- [ ] GenderSelector.tsx
  - בחירה: זכר / נקבה / רבים / ארגון
  - אייקונים ברורים
  - שמירה בהקשר השדה
- [ ] אינטגרציה בשדות דינמיים
- [ ] הדגמה חזותית של השינוי

**זמן**: 2 שעות

##### שלב 3: אינטגרציה במסמכים
- [ ] החלפה אוטומטית בזמן יצירת מסמך
- [ ] תצוגה מקדימה עם הנטיות הנכונות
- [ ] תמיכה בייצוא (PDF/Word)

**זמן**: 2 שעות

**סה"כ מערכת זכר/נקבה**: 6 שעות

#### E. טבלאות דינמיות מתקדמות
##### שלב 1: DynamicTable - טבלה גמישה לחלוטין
- [ ] הגדרת עמודות דינמית (בחר מה יופיע)
- [ ] סוגי עמודות: טקסט, מספר, תאריך, בחירה
- [ ] הוספה/מחיקה/שכפול שורות
- [ ] ניהול רוחב עמודות
- [ ] עיצוב (גבולות, צבעים, padding)

**זמן**: 3 שעות

##### שלב 2: PartyTable - טבלת צדדים מתקדמת
- [ ] בחירת תפקיד: תובע / נתבע / מיוצג
- [ ] טבלה מלאה למי שאני מייצג
- [ ] טבלה מצומצמת לצד שני
- [ ] מעבר בין מצבים (toggle)
- [ ] שמירת הקשר

**דוגמת שימוש**:
```tsx
<PartyTable
  myRole="plaintiff"        // אני מייצג תובעים
  myPartyColumns={[         // עמודות מלאות לתובעים
    'שם', 'ת.ז', 'כתובת', 'טלפון', 'אימייל'
  ]}
  opponentColumns={[        // עמודות מינימליות לנתבעים
    'שם', 'ת.ז'
  ]}
  onChange={(data) => {}}
/>
```

**זמן**: 4 שעות

##### שלב 3: ConditionalBlock - תנאים דינמיים
- [ ] "הצג בלוק רק אם..."
- [ ] תנאים: שדה מלא, שדה ריק, ערך שווה ל...
- [ ] הצגת/הסתרת טבלאות לפי תנאים
- [ ] לוגיקה מורכבת (AND/OR)

**זמן**: 3 שעות

**סה"כ טבלאות**: 10 שעות

#### F. שיפור AI - ממשק וחוויה
##### שלב 1: רכיב AIImprover
- [ ] כפתור "שפר עברית משפטית" בולט
- [ ] טוען (loading) בזמן עיבוד
- [ ] הצגת טקסט משופר
- [ ] כפתורים: אשר / דחה / ערוך ידנית

**זמן**: 2 שעות

##### שלב 2: השוואה ויזואלית
- [ ] BeforeAfterComparison.tsx
- [ ] הדגשת שינויים (diff)
- [ ] הסבר למה שונה
- [ ] אפשרות לבחור חלקים מהשיפור

**זמן**: 2 שעות

##### שלב 3: בחירת סגנון וקונטקסט
- [ ] בחירת סגנון: פורמלי / פשוט / מפורט
- [ ] הקשר מסמך: כתב בית דין / צוואה / הסכם
- [ ] שמירת העדפות משתמש
- [ ] למידה מהיסטוריה

**זמן**: 2 שעות

**סה"כ שיפור AI**: 6 שעות

---

### 🟡 MEDIUM - שיפורים חשובים (שבוע 2)

#### G. ייצוא מתקדם ל-PDF/Word
- [ ] תמיכה מלאה בפונט David
- [ ] תמיכה בטבלאות מורכבות
- [ ] שמירת עיצוב מדויק
- [ ] מספור עמודים מתקדם
- [ ] כותרות ותחתיות דינמיות
- [ ] watermark אופציונלי

**זמן**: 4 שעות

#### H. מערכת תבניות מוכנות מראש
- [ ] 10 תבניות מוכנות:
  1. צו ירושה
  2. צוואה
  3. ייפוי כוח
  4. כתב תביעה
  5. כתב הגנה
  6. הסכם שכירות
  7. הסכם מכר
  8. בקשה לביה"ד
  9. ערעור
  10. תצהיר
- [ ] לכל תבנית: שדות מוגדרים מראש
- [ ] אפשרות לערוך ולהתאים אישית
- [ ] שמירה כ-favorites

**זמן**: 8 שעות (שעה לכל תבנית)

#### I. חיפוש וסינון תבניות
- [ ] חיפוש full-text
- [ ] סינון לפי קטגוריה
- [ ] סינון לפי תגיות
- [ ] מיון: לפי תאריך, פופולריות, שם
- [ ] שמירת חיפושים

**זמן**: 2 שעות

---

### 🟢 NICE TO HAVE - תכונות מתקדמות (שבוע 3+)

#### J. ממשק מודולרי מתקדם
- [ ] דרג-אנד-דרופ לשדות
- [ ] דרג-אנד-דרופ לבלוקים
- [ ] תצוגה מקדימה בזמן אמת
- [ ] undo/redo
- [ ] shortcuts מקלדת

**זמן**: 6 שעות

#### K. שיתוף ושמירה ענן
- [ ] שמירה לשרת (לא רק localStorage)
- [ ] שיתוף תבניות עם אחרים
- [ ] גרסאות ושחזור
- [ ] תבניות ציבוריות/פרטיות

**זמן**: 10 שעות

#### L. הרשאות ותפקידים
- [ ] משתמש רגיל / מנהל / סופר-אדמין
- [ ] מי יכול ליצור תבניות
- [ ] מי יכול לערוך
- [ ] audit log

**זמן**: 5 שעות

---

## 📊 סיכום זמנים

| קטגוריה | זמן מוערך | עדיפות |
|---------|-----------|---------|
| תיקונים קריטיים (A-B) | 2 שעות | 🔴 |
| חתימות (C) | 3 שעות | 🟠 |
| זכר/נקבה (D) | 6 שעות | 🟠 |
| טבלאות מתקדמות (E) | 10 שעות | 🟠 |
| שיפור AI (F) | 6 שעות | 🟠 |
| ייצוא מתקדם (G) | 4 שעות | 🟡 |
| תבניות מוכנות (H) | 8 שעות | 🟡 |
| חיפוש וסינון (I) | 2 שעות | 🟡 |
| ממשק מתקדם (J) | 6 שעות | 🟢 |
| שמירה ענן (K) | 10 שעות | 🟢 |
| הרשאות (L) | 5 שעות | 🟢 |
| **סה"כ** | **62 שעות** | |

---

## 🎯 תכנון ביצוע מומלץ

### שבוע 1: יסודות
- יום 1: תיקונים + בדיקה שהכל רץ (2 שעות)
- יום 2-3: חתימות + זכר/נקבה (9 שעות)
- יום 4-5: טבלאות דינמיות (10 שעות)

### שבוע 2: שיפורים
- יום 1-2: שיפור AI (6 שעות)
- יום 3: ייצוא מתקדם (4 שעות)
- יום 4-5: תבניות מוכנות (8 שעות)

### שבוע 3: polish
- יום 1: חיפוש וסינון (2 שעות)
- יום 2-3: ממשק מתקדם (6 שעות)
- יום 4-5: תכונות נוספות לפי בקשה

---

## 🎓 דוגמה: כתב בית דין עם טבלת צדדים גמישה

```typescript
// המודול
export default function CourtPetition() {
  const [myRole, setMyRole] = useState<'plaintiff' | 'defendant'>('plaintiff');
  const [parties, setParties] = useState({
    plaintiffs: [],
    defendants: []
  });

  return (
    <div>
      {/* בחירת תפקיד */}
      <div>
        <label>אני מייצג את:</label>
        <select value={myRole} onChange={(e) => setMyRole(e.target.value)}>
          <option value="plaintiff">התובעים</option>
          <option value="defendant">הנתבעים</option>
        </select>
      </div>

      {/* טבלת הצד שלי - מלאה */}
      <PartyTable
        title={myRole === 'plaintiff' ? 'התובעים' : 'הנתבעים'}
        columns={['שם', 'ת.ז', 'כתובת', 'טלפון', 'אימייל', 'ב"כ']}
        data={myRole === 'plaintiff' ? parties.plaintiffs : parties.defendants}
        onChange={(data) => {
          if (myRole === 'plaintiff') {
            setParties({...parties, plaintiffs: data});
          } else {
            setParties({...parties, defendants: data});
          }
        }}
        minRows={1}
        maxRows={10}
        style="detailed"
      />

      {/* טבלת הצד השני - מינימלית */}
      <PartyTable
        title={myRole === 'plaintiff' ? 'הנתבעים' : 'התובעים'}
        columns={['שם', 'ת.ז']}  // רק פרטים בסיסיים
        data={myRole === 'plaintiff' ? parties.defendants : parties.plaintiffs}
        onChange={(data) => {
          if (myRole === 'plaintiff') {
            setParties({...parties, defendants: data});
          } else {
            setParties({...parties, plaintiffs: data});
          }
        }}
        minRows={1}
        maxRows={10}
        style="minimal"
      />
    </div>
  );
}
```

---

## 📌 הערות חשובות

### למה המערכת תהיה גמישה:
1. **כל מודול עצמאי** - שינוי בצו ירושה לא ישפיע על כתב בית דין
2. **רכיבים משותפים** - DynamicTable, PartyTable, SignatureBlock
3. **קלות הוספה** - להוסיף מסמך חדש = קובץ אחד חדש
4. **בחירה בכל רמה** - המשתמש שולט בכל פרט

### עקרונות פיתוח:
- ✅ **קוד קצר** - כל רכיב < 300 שורות
- ✅ **מודולרי** - כל רכיב עושה דבר אחד טוב
- ✅ **ברור** - שמות משתנים בעברית וברורים
- ✅ **מתועד** - כל רכיב עם דוגמאות שימוש
- ✅ **נבדק** - לפני push לדוקר

---

## ⚡ תחילת עבודה - הצעדים הראשונים

### 1️⃣ **עכשיו מיד** (30 דקות):
- [x] העתקת כל הקבצים
- [ ] תיקון שגיאות קומפילציה
- [ ] הרצה מוצלחת בדוקר
- [ ] רענון דף + בדיקה שהכל טוען

### 2️⃣ **אחר כך** (היום):
- [ ] מערכת חתימות בסיסית
- [ ] תחילת עבודה על זכר/נקבה (מילון ראשוני)

### 3️⃣ **מחר**:
- [ ] טבלת צדדים (PartyTable) ראשונית
- [ ] אינטגרציה של AI Improver בממשק

---

## 💬 שאלות לדיון

לפני שאני ממשיך לפתח, בואי נתאם:

1. **עדיפויות**: מה הכי חשוב לך?
   - חתימות?
   - זכר/נקבה?
   - טבלאות צדדים?
   - שיפור AI?

2. **מודולים**: אילו מסמכים הכי נחוצים?
   - צו ירושה (יש)
   - צוואה
   - כתב בית דין
   - הסכם
   - אחר?

3. **זרימת עבודה**: מה גורם לך הכי הרבה בעיות עכשיו?

---

## 📞 הבא

אני ממתין להחלטה שלך מה לעשות קודם, ובינתיים אני:
1. מתקן את שגיאות הקומפילציה
2. מעלה את הדוקר
3. מתחיל לעבוד על התכונה שהכי חשובה לך

**ספרי לי מה הכי דחוף ונתחיל! 🚀**
